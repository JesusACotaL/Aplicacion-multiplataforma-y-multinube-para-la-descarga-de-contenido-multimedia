<app-navbar></app-navbar>
<div style="padding: 1rem;">
    <h2> {{ manga.name }}</h2>
</div>
<div class="manga-contenedor">
    <div *ngIf="manga.name" class="resumen">
        <div class="logotipo">
            <img [src]="manga.img" alt="" class="img-fluid" width="225">
            <div *ngIf="user">
                <br>
                <span>Your rating: {{userRating}}</span>
                <div class="rating">
                    <form>
                        <p class="clasificacion">
                          <input id="radio1" type="radio" name="estrellas" [value]="radio1" (click)="rate(5)" [(ngModel)]="radio1">
                          <label for="radio1">★</label>
                          <input id="radio2" type="radio" name="estrellas" [value]="radio2"  (click)="rate(4)" [(ngModel)]="radio2">
                          <label for="radio2">★</label>
                          <input id="radio3" type="radio" name="estrellas" [value]="radio3"  (click)="rate(3)" [(ngModel)]="radio3">
                          <label for="radio3">★</label>
                          <input id="radio4" type="radio" name="estrellas" [value]="radio4"  (click)="rate(2)" [(ngModel)]="radio4">
                          <label for="radio4">★</label>
                          <input id="radio5" type="radio" name="estrellas" [value]="radio5"  (click)="rate(1)" [(ngModel)]="radio5">
                          <label for="radio5">★</label>
                        </p>
                    </form>
                </div>
            </div>
        </div>
        <div class="informacion">     
            <h5>Ranking {{manga.statistics.popularity}}</h5>
            <span>{{manga.name_english}}</span>
            <span>{{manga.statistics.score}} <i class="bi bi-star-fill"></i></span>
            <span>By: {{manga.authors}}</span>
            <span>{{manga.genres}}</span>
            <span>{{manga.date}}</span>
            <span>Status: {{manga.status}}</span>
            <a *ngIf="manga.site" [href]="manga.site" target="_blank">Oficial site <i class="bi bi-box-arrow-up-right"></i></a>
            <a [href]="myanimelisturl" target="_blank">Visit on myanimelist <i class="bi bi-box-arrow-up-right"></i></a>
        </div>
    </div>
    <div class="capitulos">
        <div *ngIf="cargando">
            <div style="display: flex; align-items: center; justify-content: center; gap: 2rem; position: relative;">
                <div style="position: absolute; right: 50%+10rem;">Cargando <br> fuentes...</div>
                <div style="width: 10rem; height: 10rem;" class="spinner-border" role="status" aria-hidden="true"></div>
            </div>
        </div>
        <div *ngIf="seleccionandoManga">
            <h4>Selecciona una fuente para leer el manga: </h4>
            <div class="fuentes">
                <div class="fuenteManga" *ngFor="let fuente of fuentes" (click)="obtenerCapitulos(fuente.chapters_url)">
                    <img [src]="fuente.image_url" alt="" width="50">
                    <div style="display: flex; flex-direction: column; justify-content: center;">
                        <span>{{fuente.name}}</span>
                        <span>{{fuente.chapters_url}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="!cargando && !seleccionandoManga">
            <h1>Tomos</h1>
            <nav class="navegador">
                <ul class="pagination justify-content-center">
                    <li>
                        <span class="page-link" (click)="verColeccionPaginas(1)">Inicio</span>
                    </li>
                    <li>
                        <span class="page-link" [ngClass]="{'disabled': paginaActual === 1}" (click)="!(paginaActual === 1) && verColeccionPaginas(coleccionPaginas-5)">
                            &laquo;
                        </span>
                    </li>
                    <li [ngClass]="{'active': i === paginaActual}" *ngFor="let i of paginas | slice: coleccionPaginas - 1: coleccionPaginas + 4" (click)="verPagina(i)">
                        <span class="page-link">{{i}}</span>
                    </li>
                    <li>
                        <span class="page-link" [ngClass]="{'disabled': paginaActual > paginas.length-5}" (click)="!(paginaActual > paginas.length-5) && verColeccionPaginas(coleccionPaginas+5)">
                            &raquo;
                        </span>
                    </li>
                    <li>
                        <span class="page-link" (click)="verColeccionPaginas(paginas.length-4)">Ultimo</span>
                    </li>
                </ul>
            </nav>
            <ul class="list-group list-group-flush" style="border-radius: .5rem;">
                <li (click)="mostrarEpisodio(capitulo['name'], capitulo['url'])" class="list-group-item text-white capitulo" *ngFor="let capitulo of capitulos | slice: (paginaActual-1) * capitulosPorPagina : paginaActual * capitulosPorPagina">
                    <span>{{ capitulo['name'] }}</span>
                    <i class="bi bi-file-earmark-arrow-down ms-auto"></i>
                </li>
            </ul>
        </div>
        <div *ngIf="!cargando && !seleccionandoManga && capitulos.length < 1" class="text-center">
            No se encontraron capitulos.
        </div>
    </div>
</div>
<div class="info-adicional">
    <hr>
    <span style="font-style: italic;">
        {{manga.synopsis}}
    </span>
    <br><br>
    <span>
        {{manga.background}}
    </span>
    <div>
        <h4>Main Plot</h4>
        <div class="characters">
            <div class="character" *ngFor="let character of getMainPlot()">
                <img [src]="character.image" alt="" class="img-fluid">
                <div>{{character.name}}</div>
            </div>
        </div>
        <h4>Adittional characters</h4>
        <div class="characters">
            <div class="character" *ngFor="let character of getAdditionalCharacters()">
                <img [src]="character.image" alt="" class="img-fluid">
                <div>{{character.name}}</div>
            </div>
        </div>
    </div>
</div>

<app-manga-modal [pFuenteManga]="fuenteActual" [pMostrar]="mostrarModal" [pTitulo]="tituloActual"></app-manga-modal>
