<app-navbar></app-navbar>
<div class="manga-contenedor">
    <div *ngIf="manga.name" class="resumen">
        <h1> {{ manga.name }}</h1>
        <img [src]="manga.img" alt="" class="img-fluid" width="225">
        <hr>
        <p class="card-text">
            Calificacion: {{manga.statistics.score}} <br>
            Autores: {{manga.authors}}
        </p>
    </div>
    <div class="capitulos">
        <div *ngIf="cargando">
            <div style="display: flex; align-items: center; justify-content: center; gap: 2rem; position: relative;">
                <div style="position: absolute; right: 50%+10rem;">Cargando...</div>
                <div style="width: 10rem; height: 10rem;" class="spinner-border" role="status" aria-hidden="true"></div>
            </div>
        </div>
        <div *ngIf="seleccionandoManga">
            <h4>Selecciona una fuente para leer el manga: </h4>
            <div class="fuentes">
                <div class="fuenteManga" *ngFor="let fuente of fuentes" (click)="obtenerCapitulos(fuente.chapters_url)">
                    <img [src]="fuente.image_url" alt="" width="50">
                    <div style="display: flex; flex-direction: column; justify-content: center;">
                        <span>{{fuente.name}}</span>
                        <span>{{fuente.chapters_url}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="!cargando && !seleccionandoManga">
            <h1>Tomos</h1>
            <nav class="navegador">
                <ul class="pagination justify-content-center">
                    <li>
                        <span class="page-link" (click)="verColeccionPaginas(1)">Inicio</span>
                    </li>
                    <li>
                        <span class="page-link" [ngClass]="{'disabled': paginaActual === 1}" (click)="!(paginaActual === 1) && verColeccionPaginas(coleccionPaginas-5)">
                            &laquo;
                        </span>
                    </li>
                    <li [ngClass]="{'active': i === paginaActual}" *ngFor="let i of paginas | slice: coleccionPaginas - 1: coleccionPaginas + 4" (click)="verPagina(i)">
                        <span class="page-link">{{i}}</span>
                    </li>
                    <li>
                        <span class="page-link" [ngClass]="{'disabled': paginaActual > paginas.length-5}" (click)="!(paginaActual > paginas.length-5) && verColeccionPaginas(coleccionPaginas+5)">
                            &raquo;
                        </span>
                    </li>
                    <li>
                        <span class="page-link" (click)="verColeccionPaginas(paginas.length-4)">Ultimo</span>
                    </li>
                </ul>
            </nav>
            <ul class="list-group list-group-flush" style="border-radius: .5rem;">
                <li (click)="descargarEpisodio(capitulo['url'])" class="list-group-item text-white capitulo" *ngFor="let capitulo of capitulos | slice: (paginaActual-1) * capitulosPorPagina : paginaActual * capitulosPorPagina">
                    <span>{{ capitulo['name'] }}</span>
                    <i class="bi bi-file-earmark-arrow-down ms-auto"></i>
                </li>
            </ul>
        </div>
        <div *ngIf="!cargando && !seleccionandoManga && capitulos.length < 1" class="text-center">
            No se encontraron capitulos.
        </div>
    </div>
</div>

<app-manga-modal [pFuenteManga]="fuenteActual" [pMostrar]="mostrarModal"></app-manga-modal>
